from utils import PUNCTS_STR
from typing import Literal

RESTORE_PROMPT = (
    "Ты — высококвалифицированный краудсорс-разметчик.\n"
    "Твоя задача — отредактировать транскрипт по АУДИО и тексту ниже.\n"
    "\n"
    "Исходный текст (может содержать пунктуацию и ошибки):\n"
    "{transcript}\n"
    "\n"
    "Правила:\n"
    "1) Пунктуация и регистр: расставь запятые, точки, тире, «?» и «!» по интонации и смыслу аудио; начальные буквы предложений и имена собственные — с заглавной.\n"
    "2) Содержание и порядок слов: сохраняй исходные слова и их порядок. Ничего не добавляй и не удаляй. Если сомневаешься — оставь как в исходнике.\n"
    "3) Исправления по аудио: исправляй только очевидные ошибки распознавания, когда в аудио явно слышится другой вариант слова/формы.\n"
    "4) Вставки на английском сохраняй без изменений (например, “thank you”).\n"
    "5) Числа и символы: НЕ используй цифры и спецзнаки (%, $, № и т.п.). Пиши числа словами, так как они произнесены. Единицы и валюты — словами (\"процентов\", \"рублей\", \"килограммов\"). Дробные — как слышно (\"три целых пять десятых\" или \"три точка пять\") — без цифр и символов.\n"
    "6) Оформление: используй русские кавычки «…» для прямой речи и цитат; тире — «—» для пауз/самопоправок. Многоточие ставь только при явном затухании и не более одного подряд. Не ставь повторные знаки (вроде \"!!\" или \"?!\").\n"
    "7) Спорные места: если фрагмент неразборчив, оставь исходный вариант без правок.\n"
    "\n"
    "Верни ТОЛЬКО итоговый текст в теге <out>...</out> без каких-либо комментариев.\n"
)

TAGS_PROMPT = (
    "Ты — эксперт по анализу эмоций и просодии в речи.\n"
    "Твоя задача: прослушать аудио и разметить транскрипт XML-тегами, описывающими стиль речи.\n"
    "\n"
    "Доступные теги (используй только их):\n"
    "1. Эмоции: <angry>, <calm>, <cheerful>, <sad>, <serious>\n"
    "2. Скорость/Громкость: <fast>, <slow>, <loud>, <soft>\n"
    "\n"
    "Правила:\n"
    "1. Оберни весь текст или его части в соответствующие теги.\n"
    "2. СТРОГО БЕЗ ВЛОЖЕННЫХ ТЕГОВ. Нельзя писать <angry><loud>Текст</loud></angry>. Выбери для сегмента один, наиболее яркий стиль.\n"
    "3. Если стиль меняется, сначала закрой текущий тег, затем открой новый.\n"
    "4. САМ ТЕКСТ менять нельзя. Сохраняй слова, пунктуацию и порядок.\n"
    "5. Если сегмент звучит нейтрально, оставь его без тегов.\n"
    "6. ВЕСЬ итоговый ответ верни строго внутри контейнера <out>...</out>.\n"
    "\n"
    "Пример формата вывода:\n"
    "<out><calm>Привет, как дела?</calm> <fast>Я очень спешу!</fast></out>\n"
)

def get_prompt(text: str, prompt_type: Literal["restore", "tags"] = "restore") -> str:
    if prompt_type == "restore":
        return RESTORE_PROMPT.format(transcript=text)
    elif prompt_type == "tags":
        return TAGS_PROMPT.format(transcript=text)
    else:
        raise ValueError(f"Unknown prompt type: {prompt_type}")


def get_bench_prompt(words_only: str) -> str:
    bench_prompt = (
        "Тебе дано АУДИО и его транскрибация без пунктуации (русский язык): {transcribe}\n"
        "\n"
        "Задача: восстановить пунктуацию для TTS, используя ТОЛЬКО знаки: {puncts}.\n"
        "Троеточие трактуй как один знак \"...\".\n"
        "\n"
        "Ключевые принципы (ПРИОРИТЕТ АУДИО > текста):\n"
        "• Слушай интонацию, паузы, длительности, ударения, громкость/энергия. Решение о знаке делай по звучанию.\n"
        "• Не добавляй/не удаляй слова, не меняй порядок слов. Разрешена ТОЛЬКО расстановка знаков из списка.\n"
        "• Всегда пиши в нижнем регистре.\n"
        "\n"
        "Эвристики расстановки:\n"
        "1) «?» — явный финальный подъём тона; при сомнении между «.» и «?» выбирай «.».\n"
        "2) «!» — высокая энергия/экспрессия и резкое завершение; при сомнении ставь «.».\n"
        "3) «,» — короткая внутренняя пауза без финального завершения.\n"
        "4) «...» — заметная пауза и недосказанность (нет финального падения).\n"
        "5) «.» — явное завершение мысли с финальным падением тона.\n"
        "6) «:» — «подвешенная» интонация перед пояснением/перечислением.\n"
        "\n"
        "Технические требования:\n"
        "• Пробелы: без пробела перед , . ! ? : и один пробел после; множественные пробелы сжать до одного.\n"
        "• Верни ТОЛЬКО резуьтат в теге <out>...</out> без комментариев.\n"
    )
    return bench_prompt.format(transcribe=words_only, puncts=PUNCTS_STR)
